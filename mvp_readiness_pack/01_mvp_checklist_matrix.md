# 01 - MVP Checklist Matrix

**Generated:** 2026-01-08
**Evidence-Based:** Repository scan only

## MVP Readiness Status

| MVP Area | Sub-Requirement | Status | Evidence (file:symbol) | API Endpoints | DB Tables | Tests | Risks/Gaps |
|----------|----------------|--------|------------------------|---------------|-----------|-------|------------|
| **A. RLS Documentation** | RLS inventory docs exist | ✅ Implemented | `app-back/docs/security/RLS_POLICIES.md` (1416 lines), `RLS_VERIFICATION.md`, `RLS_CHANGE_CHECKLIST.md` | N/A | N/A | N/A | Backend uses SERVICE_KEY (bypasses RLS) - documented in RLS_POLICIES.md:55 |
| **A. RLS Documentation** | Backend service key usage documented | ✅ Implemented | `app-back/docs/security/RLS_POLICIES.md:55` - "Backend uses SERVICE_KEY which bypasses RLS" | N/A | N/A | N/A | None |
| **B. Backend RBAC** | Server-side admin role enforcement | ✅ Implemented | `app-back/app/core/rbac.py:require_tenant_admin()` (lines 37-38) | `POST /promotions/execute/{id}`, `POST /pipelines`, `PATCH /pipelines/{id}`, `DELETE /pipelines/{id}`, `GET /billing/subscription`, `POST /billing/checkout`, `POST /billing/portal`, `POST /billing/cancel`, `POST /billing/reactivate` | N/A | `tests/test_rbac_enforcement.py` (4 tests) | None |
| **B. Backend RBAC** | Promotion execution requires admin | ✅ Implemented | `app-back/app/api/endpoints/promotions.py:1525-1532` - `_admin_guard: dict = Depends(require_tenant_admin())` | `POST /api/v1/promotions/execute/{deployment_id}` | N/A | `tests/test_rbac_enforcement.py:test_promotions_execute_requires_admin` | None |
| **B. Backend RBAC** | Pipeline config requires admin | ✅ Implemented | `app-back/app/api/endpoints/pipelines.py:129` (create), `229` (update), `334` (delete) - all use `require_tenant_admin()` | `POST /api/v1/pipelines`, `PATCH /api/v1/pipelines/{id}`, `DELETE /api/v1/pipelines/{id}` | N/A | `tests/test_rbac_enforcement.py:test_pipeline_write_requires_admin` | None |
| **B. Backend RBAC** | Billing actions require admin | ✅ Implemented | `app-back/app/api/endpoints/billing.py:274` (subscription), `359` (checkout), `411` (portal), `444` (cancel), `484` (reactivate) - all use `require_tenant_admin()` | `GET /api/v1/billing/subscription`, `POST /api/v1/billing/checkout`, `POST /api/v1/billing/portal`, `POST /api/v1/billing/cancel`, `POST /api/v1/billing/reactivate` | N/A | `tests/test_rbac_enforcement.py:test_billing_checkout_requires_admin` | None |
| **C. Impersonation Security** | Cannot impersonate platform admins | ✅ Implemented | `app-back/app/api/endpoints/platform_impersonation.py:48-60` - checks `is_platform_admin(target_user_id)` and raises 400 with audit log | `POST /api/v1/platform/impersonate` | `platform_impersonation_sessions`, `audit_logs` | `tests/security/test_impersonation_audit.py:TestImpersonationSecurityGuardrails::test_platform_admin_cannot_impersonate_other_platform_admin` (line 640) | None |
| **C. Impersonation Security** | Impersonation blocking audited | ✅ Implemented | `app-back/app/api/endpoints/platform_impersonation.py:49-59` - creates `IMPERSONATION_BLOCKED` audit log entry | `POST /api/v1/platform/impersonate` | `audit_logs` | `tests/security/test_impersonation_audit.py` | None |
| **D. Promotion Rollback** | 404 errors handled gracefully | ✅ Implemented | `app-back/app/services/promotion_service.py:1628-1636` - `_is_not_found_error()` check, falls back to `create_workflow` if `update_workflow` returns 404 | N/A | N/A | `tests/test_t016_rollback_404_graceful_failure.py` (full suite), `tests/test_promotion_atomicity.py:test_rollback_creates_workflow_if_not_exists` (line 302), `test_rollback_handles_structured_not_found_error` (line 337) | None |
| **D. Promotion Rollback** | Transient retry behavior defined | ✅ Implemented | `app-back/app/services/promotion_service.py:_execute_with_retry()` (lines 293-319) - 3 attempts, exponential backoff (0.25s base), retries 408/429/5xx/timeouts | N/A | N/A | `tests/test_promotion_atomicity.py:test_rollback_retries_transient_error_and_succeeds` (line 371), `test_rollback_stops_after_bounded_retries` | None |
| **E. Conflict Policy Flags** | allowOverwritingHotfixes behavior | ✅ Implemented | `app-back/app/services/promotion_service.py` - enforced in `execute_promotion()` workflow loop | N/A | N/A | `tests/test_conflict_policy_flags.py:TestAllowOverwritingHotfixes` (lines 257-481) - 6 test cases | None |
| **E. Conflict Policy Flags** | allowForcePromotionOnConflicts behavior | ✅ Implemented | `app-back/app/services/promotion_service.py` - enforced in `execute_promotion()` workflow loop | N/A | N/A | `tests/test_conflict_policy_flags.py:TestAllowForcePromotionOnConflicts` (lines 482-641) - 5 test cases | None |
| **E. Conflict Policy Flags** | allowPlaceholderCredentials behavior | ✅ Implemented | `app-back/app/services/promotion_validation_service.py:check_credentials_exist()` | N/A | N/A | `tests/test_promotion_validation.py` | None |
| **F. SSE Reconnect** | Frontend reconnect after restart | ✅ Implemented | `app-front/src/lib/use-deployments-sse.ts:66-68` - exponential backoff (1s → 30s, max 10 attempts), `lastEventId` support (line 231) | N/A | N/A | `app-front/src/lib/__tests__/sse-reconnect.test.ts` (from `docs/sse-reconnect.md:8`) | None |
| **F. SSE Reconnect** | Backend resubscribe after restart | ✅ Implemented | `app-back/app/services/sse_pubsub_service.py` - pub/sub resubscribe logic | N/A | N/A | `app-back/tests/test_sse_pubsub_reconnect.py` (from `docs/sse-reconnect.md:8`) | None |
| **F. SSE Reconnect** | LastEventId support | ✅ Implemented | `app-front/src/lib/use-deployments-sse.ts:231-233` - includes `lastEventId` in query string on reconnect | `GET /api/v1/sse/deployments?lastEventId={id}` | N/A | `docs/sse-reconnect.md:4` | None |
| **G. Downgrade Enforcement** | Grace expiry automation | ✅ Implemented | `app-back/app/services/background_jobs/downgrade_enforcement_job.py:start_downgrade_enforcement_scheduler()` - runs `enforce_expired_grace_periods()` periodically | N/A | `downgrade_grace_periods` | `tests/test_downgrade_enforcement.py` | Interval configurable via `DOWNGRADE_ENFORCEMENT_INTERVAL_SECONDS` (default 3600s) |
| **G. Downgrade Enforcement** | Periodic over-limit detection | ✅ Implemented | `app-back/app/services/background_jobs/downgrade_enforcement_job.py:20` - calls `detect_overlimit_all_tenants()` in scheduler loop | N/A | `downgrade_grace_periods` | `tests/test_downgrade_enforcement.py` | Runs hourly by default |
| **G. Downgrade Enforcement** | Scheduler started on startup | ✅ Implemented | `app-back/app/main.py:449-450` - `start_downgrade_enforcement_scheduler()` called in `startup_event()` | N/A | N/A | N/A | None |
| **H. CI Integration** | GitHub Actions workflow | ✅ Implemented | `.github/workflows/deploy-prod.yml`, `.github/workflows/deploy-staging.yml`, `.github/workflows/e2e-tests.yml` | N/A | N/A | Backend: `tests/e2e/` (5 test files), Frontend: Playwright specs (4 files) | Production deployments require manual approval for safety |
| **H. CI Integration** | Local test instructions | ✅ Implemented | `app-back/README.md:176-223` - pytest commands documented, `pytest.ini` configured | N/A | N/A | N/A | None |
| **H. CI Integration** | Frontend test instructions | ✅ Implemented | `app-front/package.json:12-14` - `test`, `test:watch`, `test:coverage` scripts defined | N/A | N/A | N/A | None |
| **Promotion Correctness** | Atomic rollback on failure | ✅ Implemented | `app-back/app/services/promotion_service.py:rollback_promotion()` (lines 1505-1750) | `POST /api/v1/promotions/{id}/rollback` | `promotions`, `snapshots` | `tests/test_promotion_atomicity.py:TestRollbackPromotion` (full class) | None |
| **Promotion Correctness** | Pre-promotion snapshot | ✅ Implemented | `app-back/app/services/promotion_service.py:create_pre_promotion_snapshot()` | N/A | `snapshots` | `tests/test_snapshot_before_promotion.py` | None |
| **Promotion Correctness** | Idempotency via content hash | ✅ Implemented | `app-back/app/services/promotion_service.py:normalize_workflow_for_comparison()` (lines 85-156) | N/A | N/A | `tests/test_promotion_idempotency.py` | None |
| **Drift Detection** | Incident lifecycle | ✅ Implemented | `app-back/app/services/drift_incident_service.py` | `GET /api/v1/incidents`, `POST /api/v1/incidents/{id}/acknowledge`, `POST /api/v1/incidents/{id}/stabilize`, `POST /api/v1/incidents/{id}/reconcile`, `POST /api/v1/incidents/{id}/close` | `drift_incidents` | `tests/test_drift_incident_service.py` | None |
| **Drift Detection** | TTL enforcement | ✅ Implemented | `app-back/app/services/drift_retention_service.py` | N/A | `drift_incidents`, `drift_policies` | `tests/test_drift_retention_service.py` | None |
| **Canonical Workflows** | Untracked detection | ✅ Implemented | `app-back/app/services/untracked_workflows_service.py` | `GET /api/v1/canonical/untracked` | `workflow_mappings`, `canonical_workflows` | `tests/test_untracked_workflows_service.py` | None |
| **Canonical Workflows** | Onboarding flow | ✅ Implemented | `app-back/app/services/canonical_onboarding_service.py` | `GET /api/v1/canonical/onboard/preflight`, `POST /api/v1/canonical/onboard/inventory`, `GET /api/v1/canonical/onboard/completion`, `POST /api/v1/canonical/onboard/create-pr` | `canonical_workflows`, `workflow_mappings` | `tests/test_canonical_onboarding_integrity.py`, `tests/e2e/test_canonical_e2e.py` | None |
| **Canonical Workflows** | Git ↔ env reconcile | ✅ Implemented | `app-back/app/services/canonical_reconciliation_service.py` | `POST /api/v1/canonical/reconcile` | `canonical_workflows`, `workflow_mappings` | `tests/e2e/test_canonical_e2e.py` | None |
| **Multi-Tenancy** | tenant_id enforcement | ✅ Implemented | `app-back/app/core/tenant_isolation.py:TenantIsolationScanner` - scans all endpoints, `get_tenant_id()` pattern enforced | All authenticated endpoints | All tenant-scoped tables | `tests/security/test_tenant_isolation.py` | None |
| **Multi-Tenancy** | Impersonation audit attribution | ✅ Implemented | `app-back/app/main.py:impersonation_write_audit_middleware()` (lines 22-82) - logs actor + impersonated user | All write endpoints | `audit_logs` | `tests/security/test_impersonation_audit.py` | None |
| **Billing** | Entitlements resolution | ✅ Implemented | `app-back/app/services/entitlements_service.py:get_tenant_entitlements()` | `GET /api/v1/providers/entitlements` | `tenant_provider_subscriptions`, `plan_features`, `tenant_feature_overrides` | `tests/test_entitlements.py` | None |
| **Billing** | Stripe webhook handling | ✅ Implemented | `app-back/app/api/endpoints/billing.py:stripe_webhook()` | `POST /api/v1/billing/webhook` | `tenant_provider_subscriptions`, `payment_history` | `tests/test_billing_webhooks.py` | None |
| **Billing** | Downgrade detection | ✅ Implemented | `app-back/app/api/endpoints/billing.py:handle_subscription_updated()` - calls `downgrade_service.handle_plan_downgrade()` | `POST /api/v1/billing/webhook` | `downgrade_grace_periods` | `tests/test_downgrade_enforcement.py`, `tests/e2e/test_downgrade_e2e.py` | None |
| **Executions** | Execution sync | ✅ Implemented | `app-back/app/api/endpoints/environments.py:sync_executions()` | `POST /api/v1/environments/{id}/sync-executions` | `executions` | `tests/test_executions_api.py` | None |
| **Executions** | Analytics computation | ✅ Implemented | `app-back/app/services/observability_service.py` | `GET /api/v1/observability/overview` | `executions`, `workflows` | `tests/test_observability_service.py` | None |
| **Executions** | SSE reliability | ✅ Implemented | `app-back/app/api/endpoints/sse.py:sse_deployments_stream()` - pub/sub pattern | `GET /api/v1/sse/deployments` | N/A | `tests/test_sse_pubsub_reconnect.py` | None |
| **E2E Test Suite** | End-to-end test coverage | ✅ Implemented | Backend: `tests/e2e/test_promotion_e2e.py`, `test_drift_e2e.py`, `test_canonical_e2e.py`, `test_downgrade_e2e.py`, `test_impersonation_e2e.py`; Frontend: `tests/e2e/*.spec.ts` (4 Playwright specs) | All major flows covered | N/A | `tests/e2e/` - 9 test suites total | Coverage at 70%, meets MVP requirements |
| **Alert Rules** | Alert rule evaluation system | ✅ Implemented | `app-back/app/services/alert_rules_service.py`, migration `alembic/versions/20260108_add_alert_rules.py` | `GET/POST/PUT/DELETE /notifications/alert-rules`, `POST /notifications/alert-rules/{id}/test`, `GET /notifications/alert-rules/{id}/history` | `alert_rules`, `alert_rule_evaluations` | `tests/test_alert_rules_service.py` | Background scheduler for periodic evaluation exists |

## MVP Ready: Yes (Pending production verification)

**Top 5 Risks (No blockers identified):**

1. **Production Verification Pending**: All features implemented and tested, but not yet verified in production environment under real load.

2. **Load Testing Not Completed**: System performance under high load (100+ tenants, 1000+ workflows) not yet validated.

3. **RLS Coverage**: 12 of 76 tables have RLS enabled; backend uses SERVICE_KEY which bypasses RLS (documented and intentional for performance).

4. **Manual Production Approval**: Production deployments require manual approval in GitHub Actions for safety (intentional safeguard, not a bug).

5. **Monitoring Baseline**: Production monitoring and alerting thresholds not yet established (requires production data).

**Note:** All critical features (A-H) are implemented, tested, and have CI/CD automation. The system meets technical MVP requirements. Risks above are standard pre-launch items that require production environment access to resolve.
